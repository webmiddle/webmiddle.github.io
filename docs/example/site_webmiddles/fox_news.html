<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Node.js JSX framework for modular web scraping and data integration">
    <title>Documentation | WebMiddle</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="../../../assets/css/bootstrap.min.css">

    <!-- Prism CSS customized to match github style -->
    <link rel="stylesheet" href="../../../assets/css/prism-custom.css">

    <!-- Custom styles for this template -->
    <link href="../../../assets/css/theme.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    
<!-- Fixed navbar -->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../index.html">WebMiddle</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <!-- you can exclude pages using {{#isnt}} helper: {{#isnt data.title 'Blog'}} -->
        
        <li>
          <a href="/">Home</a>
        </li>
        
        <li class="active">
          <a href="/docs">Documentation</a>
        </li>
        
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>


    <div class="container theme-showcase content" role="main">

      
<div class="content-header">
    <div class="container">
        <h1>Documentation</h1>
        <p>Learn how to use the framework effectively.</p>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-3 sidebar">
            <!-- Sidebar -->
            <ul class="nav">      <li>        <a href="/docs/introduction.html">Introduction</a>              </li>          <li>        <a href="/docs/getting_started.html">Getting started</a>              </li>          <li>        <a href="/docs/overview.html">Overview</a>        <ul class="nav">      <li>        <a href="/docs/jsx_services.html">JSX services</a>              </li>          <li>        <a href="/docs/webmiddle_objects.html">WebMiddle objects</a>              </li>          <li>        <a href="/docs/multiple_layers.html">Multiple layers</a>              </li>    </ul>      </li>          <li>        <a href="/docs/advanced/index.html">Advanced</a>        <ul class="nav">      <li>        <a href="/docs/advanced/context.html">context</a>              </li>          <li>        <a href="/docs/advanced/evaluate.html">evaluate</a>        <ul class="nav">      <li>        <a href="/docs/advanced/callvirtual.html">callVirtual</a>              </li>    </ul>      </li>    </ul>      </li>          <li>        <a href="/docs/packages.html">Packages</a>              </li>          <li>        <a href="/docs/example/index.html">Example: News Search</a>        <ul class="nav">      <li>        <a href="/docs/example/site_webmiddles/index.html">Site WebMiddles</a>        <ul class="nav">      <li>        <a class="active" href="/docs/example/site_webmiddles/fox_news.html">Fox News</a>              </li>          <li>        <a href="/docs/example/site_webmiddles/the_new_york_times.html">The New York Times</a>              </li>    </ul>      </li>          <li>        <a href="/docs/example/project_webmiddle/index.html">Project Webmiddle</a>        <ul class="nav">      <li>        <a href="/docs/example/project_webmiddle/site_handler.html">Site handler</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/meta.html">Meta</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/articledetails.html">ArticleDetails</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/searcharticles.html">SearchArticles</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/business_logic.html">Business logic</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/main.html">Main</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/sitemain.html">SiteMain</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/processpage.html">ProcessPage</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/filtering_and_merging.html">Filtering and merging</a>              </li>    </ul>      </li>          <li>        <a href="/docs/example/sample_execution.html">Sample execution</a>              </li>    </ul>      </li>    </ul>
        </div>

        <div class="col-lg-9">
            <!-- Content -->
            <div class="page-header">
                <h3 id="fox-news">Fox News</h3>
<p><br /></p>
<h4 id="articledetails">ArticleDetails</h4>
<pre><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ArticleDetails</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pipe</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HttpRequest</span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rawHtml<span class="token punctuation">"</span></span>
        <span class="token attr-name">contentType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html<span class="token punctuation">"</span></span>
        <span class="token attr-name">url</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span>
      <span class="token punctuation">/></span></span>

      <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rawHtml <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HtmlToJson</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>articleDetails<span class="token punctuation">"</span></span> <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>rawHtml<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>article<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span>
              <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>h2</span> <span class="token punctuation">></span> <span class="token attr-name">a"</span>
              <span class="token attr-name">condition</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>el <span class="token operator">=</span><span class="token operator">></span>
                el<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/category/'</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span></span>
            <span class="token punctuation">></span></span>
              <span class="token punctuation">{</span>el <span class="token operator">=</span><span class="token operator">></span>
                <span class="token comment" spellcheck="true">// "/category/science/air-and-space/astronomy.html"</span>
                <span class="token comment" spellcheck="true">// => "science/air-and-space/astronomy"</span>
                el<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/category\/(.+).html/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>category</span><span class="token punctuation">></span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>h1[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>headline<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>date</span>
              <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>time[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>datePublished<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span>
            <span class="token punctuation">></span></span>
              <span class="token punctuation">{</span><span class="token function">elAttr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>date</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>articleBody<span class="token punctuation">'</span>]</span> <span class="token attr-name">p"</span><span class="token punctuation">></span></span>
              <span class="token punctuation">{</span><span class="token function">elPipe</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token function">elMap</span><span class="token punctuation">(</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">elJoin</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HtmlToJson</span><span class="token punctuation">></span></span>
      <span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Pipe</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Let’s dive deep into the ArticleDetails service and let’s understand
what it does and how.</p>
<p>We define a service that does an http request to fetch an html resource,
that we call “rawHtml”, this is done by means of the <strong>HttpRequest</strong>
service.</p>
<p>Then, we convert that “rawHtml” resource into an “articleDetails” JSON
resource with a given schema by means of the <strong>HtmlToJson</strong> service.</p>
<p>Whenever a child of the <strong>Pipe</strong> service is defined as a function
instead that directly as JSX (as in the image), that function will be
called by the Pipe service, by passing the “resources” object containing
all the resources that have been created until that point.</p>
<p>This is needed for retrieving those resources and using them in
subsequent services.</p>
<p>The Pipe service output is the resource returned by the last child, in
this case it will be the “articleDetails” resource returned by the
HtmlToJson service.</p>
<p><br />
The schema of the “articleDetails” resource is defined via the
HtmlToJson children:</p>
<pre><code class="language-jsx"><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rawHtml <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HtmlToJson</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>articleDetails<span class="token punctuation">"</span></span> <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>rawHtml<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>article<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span>
        <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>h2</span> <span class="token punctuation">></span> <span class="token attr-name">a"</span>
        <span class="token attr-name">condition</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>el <span class="token operator">=</span><span class="token operator">></span> el<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/category/'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">></span></span>
        <span class="token punctuation">{</span>el <span class="token operator">=</span><span class="token operator">></span>
          <span class="token comment" spellcheck="true">// "/category/science/air-and-space/astronomy.html"</span>
          <span class="token comment" spellcheck="true">// => "science/air-and-space/astronomy"</span>
          el<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/category\/(.+).html/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>category</span><span class="token punctuation">></span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>h1[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>headline<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>date</span> 
        <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>time[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>datePublished<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span>
      <span class="token punctuation">></span></span>
        <span class="token punctuation">{</span><span class="token function">elAttr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>date</span><span class="token punctuation">></span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>articleBody<span class="token punctuation">'</span>]</span> <span class="token attr-name">p"</span><span class="token punctuation">></span></span>
        <span class="token punctuation">{</span><span class="token function">elPipe</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          <span class="token function">elMap</span><span class="token punctuation">(</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">elJoin</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HtmlToJson</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre>
<p>In our example the HtmlToJson service will generate an “articleDetails”
resource with contentType “application/json”.</p>
<p>The actual resource content will be something like</p>
<pre><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string">"root"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"article"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"date"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"..."</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Let’s look step-by-step at how the transformation is defined and
executed:</p>
<pre><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>article<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token operator">...</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span></code></pre>
<p>We are saying that we want an “article” property as the root of the JSON
object; the el=”article” attribute is telling the service to query the
HTML document with an “article” selector, so to get a list of HTML
elements (in this case all the elements with tagName equal to
“article”).</p>
<pre><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span>
  <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>h2</span> <span class="token punctuation">></span> <span class="token attr-name">a"</span>
  <span class="token attr-name">condition</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>el <span class="token operator">=</span><span class="token operator">></span> el<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/category/'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="token punctuation">></span></span>
  <span class="token punctuation">{</span>el <span class="token operator">=</span><span class="token operator">></span>
    <span class="token comment" spellcheck="true">// "/category/science/air-and-space/astronomy.html"</span>
    <span class="token comment" spellcheck="true">// => "science/air-and-space/astronomy"</span>
    el<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/category\/(.+).html/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>category</span><span class="token punctuation">></span></span></code></pre>
<p>We are adding a “category” JSON property as child of the “article”
element.</p>
<p>Here, the “el” selector is relative to the parent HTML element, i.e. the
HTML element associated with the JSON “article” element.</p>
<p>In case multiple HTML elements are associated with the parent JSON
element (e.g. there are multiple elements with tagName “article” in our
example) then the first one is used.</p>
<p>Thus, writing el=”h2 &gt; a” is like saying to the service: associate
this JSON element with all the HTML elements matching the “h2 &gt; a”
selector, relative to the parent HTML element.</p>
<p>The condition attribute is telling the service: only keep those HTML
elements that pass this condition. The condition can be specified as a
function that takes each element and returns true if the element should
be included.</p>
<p>Note: the service is using <strong>cheerio</strong> for parsing the HTML document, it
is a NodeJS subset of jQuery, thus the selectors and the “el” objects
themselves follow the cheerio/jQuery syntax.</p>
<p>This means that when we talk about an “el” object, we are actually
referring to a collection of objects with a set of functions to
manipulate them, however most functions will actually be applied only on
the first element of the collection, like the “attr” function.</p>
<p>This does not matter in case of the “condition” function, since it is
called every time with a collection consisting of a single different
element, but will matter later.</p>
<p>Let’s now look at the “category” child, it is a JavaScript expression
instead that another JSX element; this is because we are actually
specifying what the value of the element should be.</p>
<p>Most of the times the data to extract from an HTML element will be
similar: its text content, the value of an attribute, etc. For this
reason, the service provides some helper functions that can make the
extraction more declarative.</p>
<pre><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>h1[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>headline<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>date</span> 
  <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>time[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>datePublished<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span>
<span class="token punctuation">></span></span>
  <span class="token punctuation">{</span><span class="token function">elAttr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>date</span><span class="token punctuation">></span></span></code></pre>
<p>A helper function takes zero or more arguments and returns a function
that, given a collection of elements (and the cheerio parser) returns a
certain value. By convention, their name always starts with “el”.</p>
<p>The following are the internal implementations of the <strong>elText</strong> and
<strong>elAttr</strong> helpers:</p>
<pre><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> el <span class="token operator">=</span><span class="token operator">></span> el<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> el<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">elAttr</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> el <span class="token operator">=</span><span class="token operator">></span> el<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Namely, elText() supports both form input elements and normal html
elements; in the former case it returns the value of the input, in the
latter case it returns the text of the html element.</p>
<p>The elAttr(attrName) attribute just returns the value of the attrName
attribute.</p>
<p>Both of these helpers operate on the first element of the collection,
however sometimes we want to extract the value by executing a function
on each element. This is what the <strong>elMap</strong> helper is for:</p>
<pre><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">elMap</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> $<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> el<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> currDomEl<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> 
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>currDomEl<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>It is just a plain implementation of the map function for Cheerio
collections: it calls the provided callback with each element and
creates an array with the result of each call.</p>
<p>Another helper called <strong>elJoin</strong> does what the name suggests: given a
separator, it joins the values in a cheerio collection with such
separator. This makes sense because data like strings can be contained
in a cheerio collection.</p>
<pre><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">elJoin</span><span class="token punctuation">(</span>separator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> el <span class="token operator">=</span><span class="token operator">></span> el<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>separator<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Finally, often we might want to specify a sequence of functions that we
want to execute to get the final value, where each function is called
with the output of the previous function.</p>
<p>This is what the <strong>elPipe</strong> helper is for:</p>
<pre><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">elPipe</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> $<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
    tasks<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>currValue<span class="token punctuation">,</span> task<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">task</span><span class="token punctuation">(</span>currValue<span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Here is how these more advanced helpers are used in our example to
extract the text of the article, that in our HTML is contained in
paragraphs alternated with other types of content (images, ads, etc.)
that we don’t want to include:</p>
<pre><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div[itemprop<span class="token punctuation">=</span><span class="token punctuation">'</span>articleBody<span class="token punctuation">'</span>]</span> <span class="token attr-name">p"</span><span class="token punctuation">></span></span>
  <span class="token punctuation">{</span><span class="token function">elPipe</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">elMap</span><span class="token punctuation">(</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">elJoin</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span></code></pre>
<p>Basically, we are getting the text of each paragraph and then joining
them all together with two line breaks as separator.</p>
<p><hr /></p>
<h4 id="searcharticles">SearchArticles</h4>
<pre><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">SearchArticles</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token punctuation">,</span> startYear<span class="token punctuation">,</span> endYear<span class="token punctuation">,</span> pageNumber <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pipe</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Browser</span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rawHtml<span class="token punctuation">"</span></span>
        <span class="token attr-name">contentType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html<span class="token punctuation">"</span></span>
        <span class="token attr-name">url</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>
          <span class="token template-string"><span class="token string">`http://www.foxnews.com/search-results/search`</span></span> <span class="token operator">+</span>
          <span class="token template-string"><span class="token string">`?q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;ss=fn`</span></span> <span class="token operator">+</span>
          <span class="token punctuation">(</span>startYear <span class="token operator">?</span> <span class="token template-string"><span class="token string">`&amp;min_date=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>startYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-01-01`</span></span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          <span class="token punctuation">(</span>endYear <span class="token operator">?</span> <span class="token template-string"><span class="token string">`&amp;max_date=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>endYear<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-12-31`</span></span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span>
          <span class="token template-string"><span class="token string">`&amp;start=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token function">toStart</span><span class="token punctuation">(</span>pageNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
        <span class="token punctuation">}</span></span>
        <span class="token attr-name">waitFor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[ng-repeat<span class="token punctuation">=</span><span class="token punctuation">'</span>article</span> <span class="token attr-name">in</span> <span class="token attr-name">articles']"</span>
      <span class="token punctuation">/></span></span>

      <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rawHtml <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HtmlToJson</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>searchArticles<span class="token punctuation">"</span></span> <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>rawHtml<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>count</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[ng-bind<span class="token punctuation">=</span><span class="token punctuation">'</span>numFound<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token punctuation">{</span><span class="token function">elPipe</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
              <span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">normalizeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>count</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>articles</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[ng-repeat<span class="token punctuation">=</span><span class="token punctuation">'</span>article</span> <span class="token attr-name">in</span> <span class="token attr-name">articles']"</span><span class="token punctuation">></span></span>
            <span class="token punctuation">{</span><span class="token function">elMap</span><span class="token punctuation">(</span>el <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">el</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>el<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span>
                  <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a[ng-bind<span class="token punctuation">=</span><span class="token punctuation">'</span>article.title<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span>
                <span class="token punctuation">></span></span>
                  <span class="token punctuation">{</span><span class="token function">elAttr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a[ng-bind<span class="token punctuation">=</span><span class="token punctuation">'</span>article.title<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span>
                  <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[ng-if<span class="token punctuation">=</span><span class="token punctuation">'</span>article.description<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span>
                <span class="token punctuation">></span></span>
                  <span class="token punctuation">{</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>date</span> <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>.search-date<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token function">elText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>date</span><span class="token punctuation">></span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span>
                  <span class="token attr-name">el</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[ng-if<span class="token punctuation">=</span><span class="token punctuation">'</span>article.image<span class="token punctuation">'</span>]</span> <span class="token attr-name">img"</span>
                <span class="token punctuation">></span></span>
                  <span class="token punctuation">{</span><span class="token function">elAttr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">></span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>articles</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HtmlToJson</span><span class="token punctuation">></span></span>
      <span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Pipe</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Let’s see the differences with respect to the previous service.</p>
<p>Instead of the HttpRequest service, here we are using the <strong>Browser</strong>
service. It looks very similar in terms of interface, but it actually
uses a headless browser, such as PhtantomJS, to fetch the page and to
execute any JavaScript that may run on it.</p>
<p>This service is very useful in case of single page webapps, or with any
other kind of site that uses JavaScript to load and create parts of the
page dynamically.</p>
<p>This is the case of the search results of foxnews, which are loaded via
JavaScript.</p>
<p>The “waitFor” attribute tells the service to wait until an element with
the given selector is found on the page, it can be used to wait for the
JavaScript content to be fully loaded before returning the current
content of the page.</p>
<p>Differently from the previous service, where we only had an “url”
parameter, here we have other parameters such as “query” and
“pageNumber”, the url that is built is based on them.</p>
<p>You can note how the built-in “encodeURIComponent” JavaScript function
is used to properly include the parameters into the url, so to escape
any special url character.</p>
<p>Moreover, we are following a “pageNumber” approach, where the user can
specify which page of results to get. However, the actual site only
supports a “start” based approach, where the index of the first result
to return must be specified.</p>
<p>Still, we can just convert the pageNumber to the “start” value, by using
a simple function based on the number of results per page.</p>
<p>This is what the “toStart” function is for, it is a function created by
the service developer, it is not provided by the framework. It shows yet
another time how you can embed and reference functions and any other
kind of JavaScript expressions into JSX:</p>
<pre><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">toStart</span><span class="token punctuation">(</span>pageNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> pageNumber <span class="token operator">*</span> config<span class="token punctuation">.</span>resultsPerPage<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Here, the “config“ variable is just a simple configuration object that
can be used by any site service:</p>
<pre><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  resultsPerPage<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>In terms of HtmlToJson conversion, an interesting operation is how the
list of HTML articles is converted into a JSON array via the elMap
helper.</p>
<p>In foxnews search results page, every article matches the
“[ng-repeat=’article in articles’]” selector, thus the “articles” JSON
element is associated with a collection containing all the HTML article
elements.</p>
<p>To specify the articles content, we map every HTML element of this
collection into a JSX element. This is what we do with</p>
<pre><code class="language-jsx"><span class="token punctuation">{</span><span class="token function">elMap</span><span class="token punctuation">(</span>el <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">el</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>el<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
    <span class="token operator">...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre>
<p>Namely, instead of specifying the selector as a string in the “el”
attribute, we directly pass the element we have in scope. The service
will just use it. This is the power of JSX!</p>
<p>The elMap helper will return an array of JSX elements, and as stated
previously, when returning an array every item is evaluated recursively,
thus we will have a list of “article” elements in our JSON object.</p>

            </div>
            <div class="page-nav">
                
                <span class="previous">Previous: <a href="/docs/example/site_webmiddles/index.html">Site WebMiddles</a></span>
                
                
                <span class="next">Next: <a href="/docs/example/site_webmiddles/the_new_york_times.html">The New York Times</a></span>
                
            </div>
        </div>
    </div>
</div>

    </div>

    <footer class="footer text-center text-muted">
  <p>
    <span><a href="https://github.com/webmiddle/webmiddle">webmiddle</a></span>
     · 
    <span>MIT © <a href="https://github.com/Maluen">Manuel Dell&#x27;Elce</a></span>
  </p>
  <p>
    Found an issue with the docs? Report it <a href="https://github.com/webmiddle/webmiddle.github.io/issues">here</a>.
  </p>
</footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../../../assets/js/bootstrap.min.js"></script>
  </body>
</html>
