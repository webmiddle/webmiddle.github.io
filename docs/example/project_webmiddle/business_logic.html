<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Node.js JSX framework for modular web scraping and data integration">
    <title>Documentation | WebMiddle</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="../../../assets/css/bootstrap.min.css">

    <!-- Prism CSS customized to match github style -->
    <link rel="stylesheet" href="../../../assets/css/prism-custom.css">

    <!-- Custom styles for this template -->
    <link href="../../../assets/css/theme.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    
<!-- Fixed navbar -->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../index.html">WebMiddle</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <!-- you can exclude pages using {{#isnt}} helper: {{#isnt data.title 'Blog'}} -->
        
        <li>
          <a href="/">Home</a>
        </li>
        
        <li class="active">
          <a href="/docs">Documentation</a>
        </li>
        
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>


    <div class="container theme-showcase content" role="main">

      
<div class="content-header">
    <div class="container">
        <h1>Documentation</h1>
        <p>Learn how to use the framework effectively.</p>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-3 sidebar">
            <!-- Sidebar -->
            <ul class="nav">      <li>        <a href="/docs/introduction.html">Introduction</a>              </li>          <li>        <a href="/docs/overview.html">Overview</a>        <ul class="nav">      <li>        <a href="/docs/jsx_services.html">JSX services</a>              </li>          <li>        <a href="/docs/multiple_layers.html">Multiple layers</a>              </li>    </ul>      </li>          <li>        <a href="/docs/getting_started.html">Getting started</a>              </li>          <li>        <a href="/docs/technical_documentation/index.html">Technical documentation</a>        <ul class="nav">      <li>        <a href="/docs/technical_documentation/webmiddle.html">webmiddle</a>        <ul class="nav">      <li>        <a href="/docs/technical_documentation/evaluate.html">evaluate</a>              </li>          <li>        <a href="/docs/technical_documentation/callvirtual.html">callVirtual</a>              </li>    </ul>      </li>          <li>        <a href="/docs/technical_documentation/cookiemanager.html">CookieManager</a>              </li>          <li>        <a href="/docs/technical_documentation/pipe.html">Pipe</a>              </li>          <li>        <a href="/docs/technical_documentation/parallel.html">Parallel</a>              </li>          <li>        <a href="/docs/technical_documentation/arraymap.html">ArrayMap</a>              </li>          <li>        <a href="/docs/technical_documentation/resume.html">Resume</a>              </li>          <li>        <a href="/docs/technical_documentation/httprequest.html">HttpRequest</a>              </li>          <li>        <a href="/docs/technical_documentation/browser.html">Browser</a>              </li>          <li>        <a href="/docs/technical_documentation/cheeriotovirtual.html">CheerioToVirtual</a>              </li>          <li>        <a href="/docs/technical_documentation/jsonselecttovirtual.html">JSONSelectToVirtual</a>              </li>          <li>        <a href="/docs/technical_documentation/virtualtojson.html">VirtualToJson</a>              </li>          <li>        <a href="/docs/technical_documentation/html-xml-json_to_json.html">HTML/XML/JSON to JSON</a>              </li>    </ul>      </li>          <li>        <a href="/docs/example/index.html">Example: News Search</a>        <ul class="nav">      <li>        <a href="/docs/example/site_webmiddles/index.html">Site WebMiddles</a>        <ul class="nav">      <li>        <a href="/docs/example/site_webmiddles/fox_news.html">Fox News</a>              </li>          <li>        <a href="/docs/example/site_webmiddles/the_new_york_times.html">The New York Times</a>              </li>    </ul>      </li>          <li>        <a href="/docs/example/project_webmiddle/index.html">Project Webmiddle</a>        <ul class="nav">      <li>        <a href="/docs/example/project_webmiddle/site_handler.html">Site handler</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/meta.html">Meta</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/articledetails.html">ArticleDetails</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/searcharticles.html">SearchArticles</a>              </li>          <li>        <a class="active" href="/docs/example/project_webmiddle/business_logic.html">Business logic</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/main.html">Main</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/sitemain.html">SiteMain</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/processpage.html">ProcessPage</a>              </li>          <li>        <a href="/docs/example/project_webmiddle/filtering_and_merging.html">Filtering and merging</a>              </li>    </ul>      </li>          <li>        <a href="/docs/example/sample_execution.html">Sample execution</a>              </li>    </ul>      </li>    </ul>
        </div>

        <div class="col-lg-9">
            <!-- Content -->
            <div class="page-header">
                <h3 id="business-logic">Business Logic</h3>
<p>The news search project takes as input a <strong>search.json</strong> file containing
the following object properties:</p>
<ul>
<li><p><strong>searchProps</strong>: the project input, i.e. an object with query,
startYear, endYear and so on.</p>
</li>
<li><p><strong>webmiddleSettings</strong>: settings to apply to the main webmiddle
object.</p>
</li>
<li><p><strong>evaluateOptions</strong>: custom rules for defining how services should
be evaluated. See the technical documentation for details.</p>
</li>
</ul>
<p>In addition to that, the project also takes an optional
<strong>search.private.json</strong> file, which has the same format of search.json.
This file can be used to store sensitive data such as API keys,
especially in case the project is under version control, or more
generally in case the code needs to be shared, since the user can share
the search.json while ignoring search.private.json.</p>
<p>On completion, the project produces as output a <strong>newsSearch.json</strong> file
in the <strong>output</strong> directory. This file contains the list of fetched
articles.</p>
<p>We will see that the project also supports <strong>resuming</strong>, meaning that in
case the process gets terminated before the search completed, it is able
of resuming the search from the last processed pages.</p>
<p>Resume data for the <code>sitename.com</code> site are stored under the
<code>output/sitename.com</code> folder.<br />
To start a new search and thus to skip the resume, just delete the whole
output folder.</p>
<p>In addition to resuming, the project also supports <strong>retrying network
requests</strong>, in fact the network connection might go down while the
search is running, the site might stop responding or fail and so on;
without a retrying system, the search would just terminate completely in
such a case.</p>
<p>The retrying applies to both http requests and browser requests.</p>
<p>There are cases in which a resource just isn’t available, like the case
of an url pointing to an article that was deleted, in such a case
retrying endlessly would just hang the search. For this reason, the
retrying uses a conditional rule based on the http error:</p>
<pre><code class="language-javascript"><span class="token keyword">const</span> giveupErrorCodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">410</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">isRetriable</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">Error</span> <span class="token operator">&amp;&amp;</span> err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'HttpError'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
    giveupErrorCodes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> newsSearchWebmiddle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebMiddle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  settings<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    outputBasePath<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../../../output'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    verbose<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    network<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      retries<span class="token punctuation">:</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isRetriable</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token punctuation">(</span>searchJson<span class="token punctuation">.</span>webmiddleSettings <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token punctuation">(</span>searchPrivateJson<span class="token punctuation">.</span>webmiddleSettings <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The “<strong>network.retries</strong>” setting is used by both HttpRequest and
Browser services. It can also be specified as a function that, given the
error object (<em>err</em>), returns the number of retries, with a negative
number stating “infinite retries”.</p>
<p>From the code above, you can see how the project is giving up on
retrying in case of a 410 error code, which states for <em>“old resource is
permanently unavailable and has no forwarding address”.</em></p>
<p>Finally, the project also uses error handling: if the details for an
article just can’t be found, e.g. we get the <strong>410 http error code</strong>,
then the complete crash is avoided by just creating an empty article
details.</p>
<p>Note that both resuming, retrying and error handling are made possible
by the webmiddle core, which has out-of-the-box support for such
features. See the technical documentation for details.</p>
<p>Let’s now dive deep into the services used by the project business
logic.</p>
<p>The search is started by running the Main service.</p>

            </div>
            <div class="page-nav">
                
                <span class="previous">Previous: <a href="/docs/example/project_webmiddle/searcharticles.html">SearchArticles</a></span>
                
                
                <span class="next">Next: <a href="/docs/example/project_webmiddle/main.html">Main</a></span>
                
            </div>
        </div>
    </div>
</div>

    </div>

    <footer class="footer text-center text-muted">
  <p>
    <span><a href="https://github.com/webmiddle/webmiddle">webmiddle</a></span>
     · 
    <span>MIT © <a href="https://github.com/Maluen">Manuel Dell&#x27;Elce</a></span>
  </p>
  <p>
    Found an issue with the docs? Report it <a href="https://github.com/webmiddle/webmiddle.github.io/issues">here</a>.
  </p>
</footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../../../assets/js/bootstrap.min.js"></script>
  </body>
</html>
